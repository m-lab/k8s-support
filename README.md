This repo contains all of the scripts and configs required to set up the
world-spanning M-Lab kubernetes (k8s) cluster.  The organization is as follows:
- [manage-cluster/](manager-cluster/) contains all the scripts necessary to set
  up and configure the cloud master node(s) as well as new nodes in Google cloud
  for monitoring services and the like.
- [config/](config/) contains service configuration files.
- [k8s/](k8s/) contains Kubernetes config files.
- [node/](node/) DEPRECATED. The files in this directory will eventually move to
  the ePoxy repository. Contains files to set up platform nodes and have them
  join the cluster.

# Kubernetes (k8s) architecture

In order to run, k8s needs:

1. A subnet
2. A VPN on that subnet that can be joined by both GCE and non-GCE machines
3. 3 distinct `etcd` instances running on different machines, all mutually backing each other up
4. An instance of `kube-apiserver`
5. An instance of `kube-controller-manager`
6. An instance of `kube-scheduler`
7. An instance of `kube-dns` (optional but very handy)
8. A certificate authority for generating certs

Each machine that wants to be controlled by k8s (each Node) needs:

1. Appropriate certs, generated by the CA on the root server
2. a VPN client connected to the VPN
3. To run `kubelet` to connect to the controller
4. To run `kube-proxy` (maybe, hopefully not required)
5. To install `cri-containerd` to respond appropriately to commands to run a
   container
6. To install CNI and any relevant plugins to allocate IPs to containers
   appropriately

To deploy NDT pod:

1. Check https://grafana.mlab-sandbox.measurementlab.net/d/Uu56HtIfb/k8s-master-cluster?orgId=1&var-datasource=k8s%20platform%20(mlab-sandbox)&var-master=All
1. cd manage-cluster
1. ./bootstrap_k8s_workloads.sh
1. kubectl get pods
